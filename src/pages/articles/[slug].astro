---
import ArticleView from "@components/ArticleView.astro";
import Draft from "@components/Draft.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { getAllArticles, slugify } from "@components/utils";
import "../../styles/markdown.css";
import { website } from "src/pages";

export async function getStaticPaths() {
    const { articles, articlesDrafts } = getAllArticles();
    const correctArticles = import.meta.env.DEV ? articles.concat(articlesDrafts) : articles; // TODO remove if
    const params = correctArticles.map((onePost) => {
        const slug = slugify(onePost.url);
        return {
            params: { slug },
            props: { post: onePost, slug },
        };
    });

    return params;
}
const { post, slug } = Astro.props;
const { Content, frontmatter } = post;
const { draft = false, description } = frontmatter;
const headings = post.getHeadings();

const RealContent = draft ? (import.meta.env.DEV ? Content : Draft) : Content;
const desc = description || frontmatter.title;
const headDesc = `${desc} - article on ${website}`;
---

<BaseLayout title={frontmatter.title} addTitle description={headDesc} keywords={frontmatter.keywords}>
    <ArticleView frontmatter={frontmatter} slug={slug} headings={headings}>
        <RealContent />
    </ArticleView>
</BaseLayout>
